<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Detox Champion</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 120px;
        }
        .container { width: 100%; max-width: 600px; margin: 0 auto; padding: 15px; }
        .screen { display: none; }
        .screen.active { display: block; }
        .welcome-card {
            background: white;
            border-radius: 20px;
            padding: 40px 25px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .app-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 45px;
        }
        .welcome-card h1 { font-size: 26px; color: #1f2937; margin-bottom: 10px; }
        .welcome-card p { color: #6b7280; margin-bottom: 30px; font-size: 15px; }
        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        input:focus { outline: none; border-color: #6366f1; }
        .goal-slider { margin: 20px 0; }
        .goal-slider label { display: block; color: #374151; font-weight: 600; margin-bottom: 10px; font-size: 15px; }
        .goal-value { font-size: 32px; color: #6366f1; font-weight: bold; text-align: center; margin: 15px 0; }
        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 22px; color: #1f2937; margin-bottom: 5px; }
        .header p { color: #6b7280; font-size: 14px; }
        .user-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            color: white;
        }
        .stat-value { font-size: 24px; font-weight: bold; }
        .stat-label { font-size: 11px; opacity: 0.9; margin-top: 5px; }
        .card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card-header { display: flex; align-items: center; margin-bottom: 15px; }
        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
        }
        .card-title { font-size: 18px; font-weight: 600; color: #1f2937; }
        .current-total {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        .current-total-label { font-size: 13px; color: #92400e; font-weight: 600; margin-bottom: 5px; }
        .current-total-value { font-size: 32px; color: #92400e; font-weight: bold; }
        .time-input-group { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; }
        .time-input-group label { flex: 1; color: #374151; font-size: 15px; font-weight: 600; }
        .time-input-group input { width: 70px; padding: 10px; margin: 0; text-align: center; font-weight: 600; }
        .app-breakdown { margin-top: 20px; padding-top: 20px; border-top: 2px solid #f3f4f6; }
        .breakdown-item { display: flex; align-items: center; margin-bottom: 12px; }
        .breakdown-item span { flex: 1; color: #374151; font-weight: 500; }
        .breakdown-inputs { display: flex; gap: 5px; align-items: center; }
        .breakdown-inputs input {
            width: 50px;
            padding: 8px;
            margin: 0;
            text-align: center;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
        }
        .challenge-item { background: #f9fafb; border-radius: 12px; padding: 18px; margin-bottom: 12px; }
        .challenge-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .challenge-title { font-weight: 600; color: #1f2937; font-size: 17px; }
        .challenge-points { background: #fbbf24; color: white; padding: 5px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .challenge-desc { color: #6b7280; font-size: 14px; margin-bottom: 12px; }
        .challenge-actions { display: flex; gap: 10px; }
        .btn-small { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; font-size: 14px; }
        .btn-complete { background: #10b981; color: white; }
        .btn-fail { background: #ef4444; color: white; }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .nav-item { flex: 1; text-align: center; padding: 8px; color: #9ca3af; cursor: pointer; }
        .nav-item.active { color: #6366f1; }
        .nav-icon { font-size: 24px; margin-bottom: 3px; }
        .nav-label { font-size: 11px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 90%;
        }
        .popup-icon { font-size: 64px; margin-bottom: 20px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999; }
        .day-entry { background: #f9fafb; border-radius: 12px; padding: 15px; margin-bottom: 10px; }
        .day-header { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 2px solid #e5e7eb; }
        .day-date { font-weight: 600; color: #1f2937; font-size: 15px; }
        .day-total { font-weight: bold; color: #6366f1; font-size: 15px; }
        .day-apps { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 13px; }
        .app-stat { color: #6b7280; }
        .app-stat strong { color: #374151; }
        .settings-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f9fafb;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .settings-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
        }
        .settings-info { flex: 1; }
        .settings-title { font-weight: 600; color: #1f2937; font-size: 15px; }
        .settings-desc { font-size: 13px; color: #6b7280; margin-top: 2px; }
        .footer {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            text-align: center;
            font-size: 11px;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
        }
        .footer a {
            color: #6366f1;
            text-decoration: none;
            margin: 0 8px;
        }
        .legal-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }
        .legal-modal.active { display: block; }
        .legal-content {
            background: white;
            max-width: 800px;
            margin: 20px auto;
            padding: 30px;
            border-radius: 15px;
        }
        .legal-content h1 { color: #1f2937; margin-bottom: 20px; font-size: 24px; }
        .legal-content h2 { color: #374151; margin-top: 25px; margin-bottom: 12px; font-size: 18px; }
        .legal-content p { color: #6b7280; line-height: 1.6; margin-bottom: 12px; font-size: 14px; }
        .close-legal-btn {
            display: inline-block;
            padding: 12px 24px;
            background: #6366f1;
            color: white;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="welcomeScreen" class="screen active">
            <div class="welcome-card">
                <div class="app-icon">üì±</div>
                <h1>Digital Detox Champion</h1>
                <p>Take control of your screen time</p>
                <input type="text" id="userName" placeholder="Your Name">
                <input type="email" id="userEmail" placeholder="Email Address">
                <div class="goal-slider">
                    <label>Daily Screen Time Goal</label>
                    <input type="range" id="goalSlider" min="1" max="12" value="4" style="width: 100%;">
                    <div class="goal-value"><span id="goalValue">4</span> hours</div>
                </div>
                <button class="btn" onclick="handleLogin()">Login & Start üöÄ</button>
                <p style="font-size:11px;color:#9ca3af;margin-top:15px;">By using this app, you agree to our <span onclick="showPrivacy()" style="color:#6366f1;cursor:pointer;text-decoration:underline">Privacy Policy</span> and <span onclick="showTerms()" style="color:#6366f1;cursor:pointer;text-decoration:underline">Terms</span></p>
            </div>
        </div>

        <div id="mainApp" class="screen">
            <div class="header">
                <h1>Welcome, <span id="displayName">Champion</span>!</h1>
                <p>Keep crushing your goals!</p>
                <div class="user-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPoints">0</div>
                        <div class="stat-label">Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="currentStreak">0</div>
                        <div class="stat-label">Day Streak üî•</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">#<span id="globalRank">999</span></div>
                        <div class="stat-label">Personal Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="challengesDone">0</div>
                        <div class="stat-label">Challenges</div>
                    </div>
                </div>
            </div>

            <div id="homeTab" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚è±Ô∏è</div>
                        <div class="card-title">Log Today's Screen Time</div>
                    </div>
                    <div class="current-total">
                        <div class="current-total-label">TODAY'S TOTAL SO FAR</div>
                        <div class="current-total-value" id="todayTotal">0h 0m</div>
                    </div>
                    <div class="time-input-group">
                        <label>Add Time:</label>
                        <input type="number" id="addHours" min="0" max="24" value="0" onchange="validateHours(this)"> h
                        <input type="number" id="addMins" min="0" max="59" value="0" onchange="validateMins(this)"> m
                    </div>
                    <div class="app-breakdown">
                        <strong style="color: #374151; display: block; margin-bottom: 15px;">Break it down:</strong>
                        <div class="breakdown-item">
                            <span>üì∫ YouTube</span>
                            <div class="breakdown-inputs">
                                <input type="number" class="app-h" min="0" max="24" value="0" oninput="validateHours(this);calcBreakdown()">h
                                <input type="number" class="app-m" min="0" max="59" value="0" oninput="validateMins(this);calcBreakdown()">m
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <span>üìò Facebook</span>
                            <div class="breakdown-inputs">
                                <input type="number" class="app-h" min="0" max="24" value="0" oninput="validateHours(this);calcBreakdown()">h
                                <input type="number" class="app-m" min="0" max="59" value="0" oninput="validateMins(this);calcBreakdown()">m
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <span>üì∏ Instagram</span>
                            <div class="breakdown-inputs">
                                <input type="number" class="app-h" min="0" max="24" value="0" oninput="validateHours(this);calcBreakdown()">h
                                <input type="number" class="app-m" min="0" max="59" value="0" oninput="validateMins(this);calcBreakdown()">m
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <span>üí¨ WhatsApp</span>
                            <div class="breakdown-inputs">
                                <input type="number" class="app-h" min="0" max="24" value="0" oninput="validateHours(this);calcBreakdown()">h
                                <input type="number" class="app-m" min="0" max="59" value="0" oninput="validateMins(this);calcBreakdown()">m
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <span>üéÆ Games</span>
                            <div class="breakdown-inputs">
                                <input type="number" class="app-h" min="0" max="24" value="0" oninput="validateHours(this);calcBreakdown()">h
                                <input type="number" class="app-m" min="0" max="59" value="0" oninput="validateMins(this);calcBreakdown()">m
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <span>üì± Other</span>
                            <div class="breakdown-inputs">
                                <input type="number" class="app-h" min="0" max="24" value="0" oninput="validateHours(this);calcBreakdown()">h
                                <input type="number" class="app-m" min="0" max="59" value="0" oninput="validateMins(this);calcBreakdown()">m
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="handleSave()">Add to Today's Total üíæ</button>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üéØ</div>
                        <div class="card-title">Today's Challenges</div>
                    </div>
                    <div id="challengesList"></div>
                </div>
            </div>

            <div id="historyTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìä</div>
                        <div class="card-title">Last 7 Days History</div>
                    </div>
                    <div id="historyList"></div>
                </div>
            </div>

            <div id="statsTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üèÜ</div>
                        <div class="card-title">Your Stats</div>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <div style="flex: 1; text-align: center; padding: 20px; background: #f9fafb; border-radius: 12px;">
                            <div style="font-size: 32px; font-weight: bold; color: #6366f1;" id="totalDays">0</div>
                            <div style="font-size: 13px; color: #6b7280; margin-top: 5px;">Days Tracked</div>
                        </div>
                        <div style="flex: 1; text-align: center; padding: 20px; background: #f9fafb; border-radius: 12px;">
                            <div style="font-size: 32px; font-weight: bold; color: #10b981;" id="avgTime">0h</div>
                            <div style="font-size: 13px; color: #6b7280; margin-top: 5px;">Avg Per Day</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settingsTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚öôÔ∏è</div>
                        <div class="card-title">Settings</div>
                    </div>
                    <div class="settings-item">
                        <div class="settings-icon">üë§</div>
                        <div class="settings-info">
                            <div class="settings-title" id="settingsName">User Name</div>
                            <div class="settings-desc" id="settingsEmail">email@example.com</div>
                        </div>
                    </div>
                    <div class="settings-item">
                        <div class="settings-icon">üéØ</div>
                        <div class="settings-info">
                            <div class="settings-title">Daily Goal</div>
                            <div class="settings-desc" id="settingsGoal">4 hours per day</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="showPrivacy()">
                        <div class="settings-icon">üîí</div>
                        <div class="settings-info">
                            <div class="settings-title">Privacy Policy</div>
                            <div class="settings-desc">View our privacy policy</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="showTerms()">
                        <div class="settings-icon">üìÑ</div>
                        <div class="settings-info">
                            <div class="settings-title">Terms of Service</div>
                            <div class="settings-desc">View terms and conditions</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="clearAllData()" style="background:#fee2e2">
                        <div class="settings-icon" style="background:#ef4444">üóëÔ∏è</div>
                        <div class="settings-info">
                            <div class="settings-title">Clear All Data</div>
                            <div class="settings-desc">Delete all your data permanently</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="privacyScreen" class="legal-modal">
            <div class="legal-content">
                <button onclick="hidePrivacy()" class="close-legal-btn">‚úï Close</button>
                <h1>Privacy Policy</h1>
                <p><strong>Last Updated:</strong> January 2025</p>
                <p>Digital Detox Champion stores all data locally on your device using browser storage.</p>
                <button onclick="hidePrivacy()" class="close-legal-btn">‚úï Close</button>
            </div>
        </div>

        <div id="termsScreen" class="legal-modal">
            <div class="legal-content">
                <button onclick="hideTerms()" class="close-legal-btn">‚úï Close</button>
                <h1>Terms of Service</h1>
                <p><strong>Last Updated:</strong> January 2025</p>
                <p>By using Digital Detox Champion, you agree to these terms.</p>
                <button onclick="hideTerms()" class="close-legal-btn">‚úï Close</button>
            </div>
        </div>
    </div>

    <div class="footer">
        ¬© 2025 Digital Detox Champion | Ages 13+ | 
        <span onclick="showPrivacy()" style="color:#6366f1;cursor:pointer">Privacy</span> | 
        <span onclick="showTerms()" style="color:#6366f1;cursor:pointer">Terms</span>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home')">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Home</div>
        </div>
        <div class="nav-item" onclick="switchTab('history')">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">History</div>
        </div>
        <div class="nav-item" onclick="switchTab('stats')">
            <div class="nav-icon">üèÜ</div>
            <div class="nav-label">Stats</div>
        </div>
        <div class="nav-item" onclick="switchTab('settings')">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-label">Settings</div>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closePopup()"></div>
    <div class="popup" id="popup">
        <div class="popup-icon" id="popupIcon">üéâ</div>
        <h2 style="color: #1f2937; margin-bottom: 10px;" id="popupTitle">Great!</h2>
        <p style="color: #6b7280;" id="popupMessage"></p>
        <button class="btn" onclick="closePopup()" style="margin-top: 20px;">Awesome!</button>
    </div>

    <script>
function safeLocalStorage() {
    try {
        const test = '__test__';
        localStorage.setItem(test, test);
        localStorage.removeItem(test);
        return true;
    } catch(e) {
        return false;
    }
}

const hasLocalStorage = safeLocalStorage();

function saveData(key, value) {
    if (hasLocalStorage) {
        try {
            localStorage.setItem(key, JSON.stringify(value));
            return true;
        } catch(e) {
            console.warn('localStorage save failed:', e);
            return false;
        }
    }
    return false;
}

function loadData(key) {
    if (hasLocalStorage) {
        try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        } catch(e) {
            console.warn('localStorage load failed:', e);
            return null;
        }
    }
    return null;
}

function removeData(key) {
    if (hasLocalStorage) {
        try {
            localStorage.removeItem(key);
            return true;
        } catch(e) {
            return false;
        }
    }
    return false;
}

var userData = {name:'',email:'',goal:4,points:0,streak:0,rank:999,challenges:0,days:{}};
var challenges = [
    {id:1,title:"2-Hour Phone-Free Focus",desc:"No phone for 2 hours",points:100,icon:"üíº"},
    {id:2,title:"Phone-Free Dinner",desc:"Enjoy meals without phone",points:50,icon:"üçΩÔ∏è"},
    {id:3,title:"Bedtime Digital Detox",desc:"1 hour before sleep",points:75,icon:"üåô"},
    {id:4,title:"Morning Without Phone",desc:"Start day phone-free",points:60,icon:"üåÖ"}
];

function getToday() {
    var d = new Date();
    return d.getFullYear() + '-' + 
           String(d.getMonth() + 1).padStart(2, '0') + '-' + 
           String(d.getDate()).padStart(2, '0');
}

function validateHours(el) {
    var v = parseInt(el.value) || 0;
    if (v < 0) v = 0;
    if (v > 24) v = 24;
    el.value = v;
}

function validateMins(el) {
    var v = parseInt(el.value) || 0;
    if (v < 0) v = 0;
    if (v > 59) v = 59;
    el.value = v;
}

function cleanOldDays() {
    var cutoff = new Date();
    cutoff.setDate(cutoff.getDate() - 7);
    var newDays = {};
    for (var date in userData.days) {
        if (new Date(date) >= cutoff) {
            newDays[date] = userData.days[date];
        }
    }
    userData.days = newDays;
}

function updateTodayDisplay() {
    var today = getToday();
    var dd = userData.days[today] || {total:0};
    var h = Math.floor(dd.total / 60);
    var m = dd.total % 60;
    document.getElementById('todayTotal').textContent = h + 'h ' + m + 'm';
}

function updateUI() {
    document.getElementById('displayName').textContent = userData.name || 'Champion';
    document.getElementById('totalPoints').textContent = userData.points;
    document.getElementById('currentStreak').textContent = userData.streak;
    document.getElementById('globalRank').textContent = userData.rank;
    document.getElementById('challengesDone').textContent = userData.challenges;
    document.getElementById('settingsName').textContent = userData.name || 'User';
    document.getElementById('settingsEmail').textContent = userData.email || 'email@example.com';
    document.getElementById('settingsGoal').textContent = userData.goal + ' hours per day';
    updateTodayDisplay();
    
    var dc = Object.keys(userData.days).length;
    document.getElementById('totalDays').textContent = dc;
    var tm = 0;
    for (var d in userData.days) { tm += userData.days[d].total; }
    var avg = dc > 0 ? (tm / 60 / dc).toFixed(1) : 0;
    document.getElementById('avgTime').textContent = avg + 'h';
}

function renderChallenges() {
    var html = '';
    for (var i = 0; i < challenges.length; i++) {
        var c = challenges[i];
        html += '<div class="challenge-item" id="ch' + c.id + '">' +
                '<div class="challenge-header">' +
                '<div class="challenge-title">' + c.icon + ' ' + c.title + '</div>' +
                '<div class="challenge-points">+' + c.points + ' pts</div>' +
                '</div>' +
                '<div class="challenge-desc">' + c.desc + '</div>' +
                '<div class="challenge-actions">' +
                '<button class="btn-small btn-complete" onclick="completeChallenge(' + c.id + ',' + c.points + ')">‚úì Completed</button>' +
                '<button class="btn-small btn-fail" onclick="failChallenge(' + c.id + ')">‚úó Failed</button>' +
                '</div></div>';
    }
    document.getElementById('challengesList').innerHTML = html;
}

function renderHistory() {
    var dates = [];
    for (var d in userData.days) { dates.push(d); }
    dates.sort().reverse();
    
    var html = '';
    if (dates.length === 0) {
        html = '<p style="color:#6b7280;text-align:center;padding:20px;">No data yet!</p>';
    } else {
        var apps = ['youtube','facebook','instagram','whatsapp','games','other'];
        var icons = ['üì∫','üìò','üì∏','üí¨','üéÆ','üì±'];
        var names = ['YouTube','Facebook','Instagram','WhatsApp','Games','Other'];
        
        for (var i = 0; i < dates.length; i++) {
            var date = dates[i];
            var data = userData.days[date];
            var d = new Date(date);
            var ds = d.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});
            var th = (data.total / 60).toFixed(1);
            
            html += '<div class="day-entry">' +
                    '<div class="day-header">' +
                    '<div class="day-date">' + ds + '</div>' +
                    '<div class="day-total">' + th + 'h</div>' +
                    '</div><div class="day-apps">';
            
            for (var j = 0; j < apps.length; j++) {
                if (data[apps[j]] && data[apps[j]] > 0) {
                    html += '<div class="app-stat">' + icons[j] + ' ' + names[j] + 
                            ': <strong>' + (data[apps[j]] / 60).toFixed(1) + 'h</strong></div>';
                }
            }
            html += '</div></div>';
        }
    }
    document.getElementById('historyList').innerHTML = html;
}

function showPopup(msg, type) {
    var icons = {excellent:'üåü', success:'üéâ', warning:'‚ö†Ô∏è', bad:'üòî'};
    var titles = {excellent:'Excellent!', success:'Great!', warning:'Careful!', bad:'Too Much!'};
    
    document.getElementById('popupIcon').textContent = icons[type] || 'üéâ';
    document.getElementById('popupTitle').textContent = titles[type] || 'Great!';
    document.getElementById('popupMessage').textContent = msg;
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('popup').style.display = 'block';
}

function closePopup() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('popup').style.display = 'none';
}

function calcBreakdown() {
    var t = 0;
    var hs = document.querySelectorAll('.app-h');
    var ms = document.querySelectorAll('.app-m');
    for (var i = 0; i < hs.length; i++) {
        t += (parseInt(hs[i].value) || 0) * 60 + (parseInt(ms[i].value) || 0);
    }
    var th = Math.floor(t / 60);
    var tm = t % 60;
    if (th > 24) { th = 24; tm = 0; }
    document.getElementById('addHours').value = th;
    document.getElementById('addMins').value = tm;
}

function handleLogin() {
    var n = document.getElementById('userName').value.trim();
    var e = document.getElementById('userEmail').value.trim();
    var g = parseInt(document.getElementById('goalSlider').value);
    
    if (!n || !e) {
        alert('Please enter your name and email!');
        return;
    }
    if (e.indexOf('@') === -1) {
        alert('Please enter a valid email!');
        return;
    }
    
    userData.name = n;
    userData.email = e;
    userData.goal = g;
    
    saveData('detoxData', userData);
    
    document.getElementById('welcomeScreen').classList.remove('active');
    document.getElementById('mainApp').classList.add('active');
    updateUI();
    renderChallenges();
    showPopup('Welcome ' + n + '! Start tracking your screen time! üöÄ', 'success');
}

function handleSave() {
    var ah = parseInt(document.getElementById('addHours').value) || 0;
    var am = parseInt(document.getElementById('addMins').value) || 0;
    var at = ah * 60 + am;
    
    if (at === 0) {
        alert('Please enter some time!');
        return;
    }
    
    var today = getToday();
    if (!userData.days[today]) {
        userData.days[today] = {
            total: 0,
            youtube: 0,
            facebook: 0,
            instagram: 0,
            whatsapp: 0,
            games: 0,
            other: 0
        };
    }
    
    var nt = userData.days[today].total + at;
    if (nt > 1440) {
        alert('Cannot exceed 24 hours per day!');
        return;
    }
    
    userData.days[today].total = nt;
    
    var hs = document.querySelectorAll('.app-h');
    var ms = document.querySelectorAll('.app-m');
    var apps = ['youtube','facebook','instagram','whatsapp','games','other'];
    
    for (var i = 0; i < 6; i++) {
        userData.days[today][apps[i]] += (parseInt(hs[i].value) || 0) * 60 + (parseInt(ms[i].value) || 0);
    }
    
    userData.points += 10;
    userData.rank = Math.max(1, Math.min(999, 1000 - Math.floor(userData.points / 10)));
    
    cleanOldDays();
    saveData('detoxData', userData);
    
    updateUI();
    renderHistory();
    
    var hrs = userData.days[today].total / 60;
    if (hrs <= userData.goal * 0.7) {
        showPopup('Awesome! Only ' + hrs.toFixed(1) + 'h today! Keep it up! üåü', 'excellent');
    } else if (hrs <= userData.goal) {
        showPopup('Great! Within your goal! +10 points! üéâ', 'success');
    } else if (hrs <= userData.goal * 1.3) {
        showPopup('Warning! You are ' + (hrs - userData.goal).toFixed(1) + 'h over your goal! ‚ö†Ô∏è', 'warning');
    } else {
        showPopup('Too much screen time! ' + hrs.toFixed(1) + 'h today! üòî', 'bad');
    }
    
    document.getElementById('addHours').value = 0;
    document.getElementById('addMins').value = 0;
    var all = document.querySelectorAll('.app-h, .app-m');
    for (var i = 0; i < all.length; i++) { all[i].value = 0; }
}

function completeChallenge(id, pts) {
    userData.points += pts;
    userData.challenges++;
    userData.rank = Math.max(1, Math.min(999, 1000 - Math.floor(userData.points / 10)));
    
    saveData('detoxData', userData);
    updateUI();
    
    document.getElementById('ch' + id).querySelector('.challenge-actions').innerHTML = 
        '<div style="color:#10b981;font-weight:600;text-align:center;">‚úì Completed!</div>';
    showPopup('Challenge completed! +' + pts + ' points! üéâ', 'success');
}

function failChallenge(id) {
    document.getElementById('ch' + id).querySelector('.challenge-actions').innerHTML = 
        '<div style="color:#ef4444;font-weight:600;text-align:center;">Try again tomorrow!</div>';
}

function switchTab(tab) {
    var tabs = document.querySelectorAll('.tab-content');
    for (var i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
    }
    
    var navs = document.querySelectorAll('.nav-item');
    for (var i = 0; i < navs.length; i++) {
        navs[i].classList.remove('active');
    }
    
    document.getElementById(tab + 'Tab').classList.add('active');
    var navIndex = tab === 'home' ? 0 : tab === 'history' ? 1 : tab === 'stats' ? 2 : 3;
    navs[navIndex].classList.add('active');
    
    if (tab === 'history') {
        renderHistory();
    }
}

function showPrivacy() {
    document.getElementById('privacyScreen').classList.add('active');
}

function hidePrivacy() {
    document.getElementById('privacyScreen').classList.remove('active');
}

function showTerms() {
    document.getElementById('termsScreen').classList.add('active');
}

function hideTerms() {
    document.getElementById('termsScreen').classList.remove('active');
}

function clearAllData() {
    if (confirm('Are you sure? This will delete ALL your data permanently! This cannot be undone!')) {
        removeData('detoxData');
        userData = {name:'',email:'',goal:4,points:0,streak:0,rank:999,challenges:0,days:{}};
        document.getElementById('mainApp').classList.remove('active');
        document.getElementById('welcomeScreen').classList.add('active');
        alert('All data cleared successfully!');
    }
}

document.getElementById('goalSlider').addEventListener('input', function() {
    document.getElementById('goalValue').textContent = this.value;
});

window.onload = function() {
    var saved = loadData('detoxData');
    if (saved) {
        userData = saved;
        cleanOldDays();
        saveData('detoxData', userData);
        document.getElementById('welcomeScreen').classList.remove('active');
        document.getElementById('mainApp').classList.add('active');
    }
    updateUI();
    renderChallenges();
    renderHistory();
};
    </script>
</body>
</html>
