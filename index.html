<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Detox Champion</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 120px;
        }
        .container { width: 100%; max-width: 600px; margin: 0 auto; padding: 15px; }
        .screen { display: none; }
        .screen.active { display: block; }
        .welcome-card {
            background: white;
            border-radius: 20px;
            padding: 40px 25px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .app-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 45px;
        }
        .welcome-card h1 { font-size: 26px; color: #1f2937; margin-bottom: 10px; }
        .welcome-card p { color: #6b7280; margin-bottom: 30px; font-size: 15px; }
        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        input:focus { outline: none; border-color: #6366f1; }
        .goal-slider { margin: 20px 0; }
        .goal-slider label { display: block; color: #374151; font-weight: 600; margin-bottom: 10px; font-size: 15px; }
        .goal-value { font-size: 32px; color: #6366f1; font-weight: bold; text-align: center; margin: 15px 0; }
        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 22px; color: #1f2937; margin-bottom: 5px; }
        .header p { color: #6b7280; font-size: 14px; }
        .user-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            color: white;
        }
        .stat-value { font-size: 24px; font-weight: bold; }
        .stat-label { font-size: 11px; opacity: 0.9; margin-top: 5px; }
        .card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card-header { display: flex; align-items: center; margin-bottom: 15px; }
        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
        }
        .card-title { font-size: 18px; font-weight: 600; color: #1f2937; }
        .current-total {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        .current-total-label { font-size: 13px; color: #92400e; font-weight: 600; margin-bottom: 5px; }
        .current-total-value { font-size: 32px; color: #92400e; font-weight: bold; }
        .time-input-group { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; }
        .time-input-group label { flex: 1; color: #374151; font-size: 15px; font-weight: 600; }
        .time-input-group input { width: 70px; padding: 10px; margin: 0; text-align: center; font-weight: 600; }
        .app-breakdown { margin-top: 20px; padding-top: 20px; border-top: 2px solid #f3f4f6; }
        .breakdown-item { display: flex; align-items: center; margin-bottom: 12px; }
        .breakdown-item span { flex: 1; color: #374151; font-weight: 500; }
        .breakdown-inputs { display: flex; gap: 5px; align-items: center; }
        .breakdown-inputs input {
            width: 50px;
            padding: 8px;
            margin: 0;
            text-align: center;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
        }
        .challenge-item { background: #f9fafb; border-radius: 12px; padding: 18px; margin-bottom: 12px; }
        .challenge-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .challenge-title { font-weight: 600; color: #1f2937; font-size: 17px; }
        .challenge-points { background: #fbbf24; color: white; padding: 5px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .challenge-desc { color: #6b7280; font-size: 14px; margin-bottom: 12px; }
        .challenge-actions { display: flex; gap: 10px; }
        .btn-small { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; font-size: 14px; }
        .btn-complete { background: #10b981; color: white; }
        .btn-fail { background: #ef4444; color: white; }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .nav-item { flex: 1; text-align: center; padding: 8px; color: #9ca3af; cursor: pointer; }
        .nav-item.active { color: #6366f1; }
        .nav-icon { font-size: 24px; margin-bottom: 3px; }
        .nav-label { font-size: 11px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 90%;
        }
        .popup-icon { font-size: 64px; margin-bottom: 20px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999; }
        .day-entry { background: #f9fafb; border-radius: 12px; padding: 15px; margin-bottom: 10px; }
        .day-header { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 2px solid #e5e7eb; }
        .day-date { font-weight: 600; color: #1f2937; font-size: 15px; }
        .day-total { font-weight: bold; color: #6366f1; font-size: 15px; }
        .day-apps { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 13px; }
        .app-stat { color: #6b7280; }
        .app-stat strong { color: #374151; }
        .settings-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f9fafb;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .settings-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
        }
        .settings-info { flex: 1; }
        .settings-title { font-weight: 600; color: #1f2937; font-size: 15px; }
        .settings-desc { font-size: 13px; color: #6b7280; margin-top: 2px; }
        .footer {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            text-align: center;
            font-size: 11px;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
        }
        .footer a {
            color: #6366f1;
            text-decoration: none;
            margin: 0 8px;
        }
        .legal-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            overflow-y: auto;
        }
        .legal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .legal-content {
            padding: 20px;
            line-height: 1.8;
        }
        .legal-content h2 { margin: 20px 0 10px; color: #1f2937; }
        .legal-content p { margin-bottom: 15px; color: #374151; }
    </style>
</head>
<body>

<div id="welcomeScreen" class="screen active">
    <div class="container">
        <div class="welcome-card">
            <div class="app-icon">üì±</div>
            <h1>Digital Detox Champion</h1>
            <p>Track your screen time and build healthier digital habits</p>
            
            <input type="text" id="userName" placeholder="Enter your name">
            <input type="email" id="userEmail" placeholder="Enter your email">
            
            <div class="goal-slider">
                <label>Daily Screen Time Goal</label>
                <div class="goal-value" id="goalValue">4</div>
                <input type="range" id="goalSlider" min="1" max="12" value="4" style="width:100%;">
                <div style="font-size:12px; color:#6b7280; margin-top:10px;">hours per day</div>
            </div>
            
            <button class="btn" onclick="handleLogin()">Start Your Journey üöÄ</button>
        </div>
    </div>
</div>

<div id="mainApp" class="screen">
    <div class="container">
        <div class="tab-content active" id="homeTab">
            <div class="header">
                <h1>Welcome, <span id="userName2"></span>!</h1>
                <p>Keep crushing your goals!</p>
                <div class="user-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="points">0</div>
                        <div class="stat-label">Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dayStreak">0</div>
                        <div class="stat-label">Day Streak üî•</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="personalScore">#999</div>
                        <div class="stat-label">Personal Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="challenges">0</div>
                        <div class="stat-label">Challenges</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Log Today's Screen Time</div>
                </div>
                
                <div class="current-total">
                    <div class="current-total-label">TODAY'S TOTAL SO FAR</div>
                    <div class="current-total-value" id="todayTotal">0h 0m</div>
                </div>

                <div class="time-input-group">
                    <label>Add Time:</label>
                    <input type="number" id="addHours" value="0" min="0" max="24">
                    <span style="color:#374151;">h</span>
                    <input type="number" id="addMins" value="0" min="0" max="59">
                    <span style="color:#374151;">m</span>
                </div>

                <div class="app-breakdown">
                    <div style="font-weight:600; color:#1f2937; margin-bottom:15px;">Break it down:</div>
                    
                    <div class="breakdown-item">
                        <span>üì∫ YouTube</span>
                        <div class="breakdown-inputs">
                            <input type="number" class="app-h" value="0" min="0" max="24" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">h</span>
                            <input type="number" class="app-m" value="0" min="0" max="59" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">m</span>
                        </div>
                    </div>

                    <div class="breakdown-item">
                        <span>üë• Facebook</span>
                        <div class="breakdown-inputs">
                            <input type="number" class="app-h" value="0" min="0" max="24" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">h</span>
                            <input type="number" class="app-m" value="0" min="0" max="59" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">m</span>
                        </div>
                    </div>

                    <div class="breakdown-item">
                        <span>üì∏ Instagram</span>
                        <div class="breakdown-inputs">
                            <input type="number" class="app-h" value="0" min="0" max="24" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">h</span>
                            <input type="number" class="app-m" value="0" min="0" max="59" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">m</span>
                        </div>
                    </div>

                    <div class="breakdown-item">
                        <span>üí¨ WhatsApp</span>
                        <div class="breakdown-inputs">
                            <input type="number" class="app-h" value="0" min="0" max="24" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">h</span>
                            <input type="number" class="app-m" value="0" min="0" max="59" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">m</span>
                        </div>
                    </div>

                    <div class="breakdown-item">
                        <span>üéÆ Games</span>
                        <div class="breakdown-inputs">
                            <input type="number" class="app-h" value="0" min="0" max="24" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">h</span>
                            <input type="number" class="app-m" value="0" min="0" max="59" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">m</span>
                        </div>
                    </div>

                    <div class="breakdown-item">
                        <span>üì± Other</span>
                        <div class="breakdown-inputs">
                            <input type="number" class="app-h" value="0" min="0" max="24" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">h</span>
                            <input type="number" class="app-m" value="0" min="0" max="59" oninput="calcBreakdown()">
                            <span style="font-size:13px; color:#6b7280;">m</span>
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="handleSave()" style="margin-top:20px;">Add to Today's Total üìä</button>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üéØ</div>
                    <div class="card-title">Today's Challenges</div>
                </div>
                <div id="challengesList"></div>
            </div>

            <!-- RECOMMENDED TOOLS CARD - NEW! -->
            <div class="card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%); border: 2px solid #667eea;">
                <div class="card-header">
                    <div class="card-icon">üõ†Ô∏è</div>
                    <div class="card-title">Recommended Tools</div>
                </div>
                <p style="color: #6b7280; margin-bottom: 15px; font-size: 14px;">
                    Discover products that helped 1000+ people achieve their digital wellness goals!
                </p>
                <button class="btn" onclick="window.location.href='tools.html'">
                    View Recommended Tools ‚Üí
                </button>
            </div>

        </div>

        <div class="tab-content" id="historyTab">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìÖ</div>
                    <div class="card-title">7-Day History</div>
                </div>
                <div id="historyList"></div>
            </div>
        </div>

        <div class="tab-content" id="statsTab">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üèÜ</div>
                    <div class="card-title">Your Statistics</div>
                </div>
                <div style="color:#6b7280; font-size:14px; line-height:1.8;">
                    <p><strong>Current Goal:</strong> <span id="currentGoal">4</span> hours/day</p>
                    <p><strong>Total Points:</strong> <span id="totalPoints">0</span></p>
                    <p><strong>Rank:</strong> #<span id="currentRank">999</span></p>
                    <p><strong>Challenges Completed:</strong> <span id="totalChallenges">0</span></p>
                    <p><strong>Current Streak:</strong> <span id="currentStreak">0</span> days üî•</p>
                </div>
            </div>
        </div>

        <div class="tab-content" id="settingsTab">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">‚öôÔ∏è</div>
                    <div class="card-title">Settings</div>
                </div>

                <!-- RECOMMENDED TOOLS IN SETTINGS - NEW! -->
                <div class="settings-item" onclick="window.location.href='tools.html'" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 2px solid #667eea;">
                    <div class="settings-icon">üõ†Ô∏è</div>
                    <div class="settings-info">
                        <div class="settings-title">Recommended Tools</div>
                        <div class="settings-desc">Products to help your digital detox journey</div>
                    </div>
                </div>

                <div class="settings-item" onclick="alert('Edit profile feature coming soon!')">
                    <div class="settings-icon">üë§</div>
                    <div class="settings-info">
                        <div class="settings-title">Edit Profile</div>
                        <div class="settings-desc">Update your name and goal</div>
                    </div>
                </div>

                <div class="settings-item" onclick="showPrivacy()">
                    <div class="settings-icon">üîí</div>
                    <div class="settings-info">
                        <div class="settings-title">Privacy Policy</div>
                        <div class="settings-desc">Read our privacy policy</div>
                    </div>
                </div>

                <div class="settings-item" onclick="showTerms()">
                    <div class="settings-icon">üìÑ</div>
                    <div class="settings-info">
                        <div class="settings-title">Terms of Service</div>
                        <div class="settings-desc">Read our terms</div>
                    </div>
                </div>

                <div class="settings-item" onclick="clearAllData()">
                    <div class="settings-icon">üóëÔ∏è</div>
                    <div class="settings-info">
                        <div class="settings-title">Clear All Data</div>
                        <div class="settings-desc">Delete all your data permanently</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home')">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Home</div>
        </div>
        <div class="nav-item" onclick="switchTab('history')">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">History</div>
        </div>
        <div class="nav-item" onclick="switchTab('stats')">
            <div class="nav-icon">üèÜ</div>
            <div class="nav-label">Stats</div>
        </div>
        <div class="nav-item" onclick="switchTab('settings')">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-label">Settings</div>
        </div>
    </div>
</div>

<div id="privacyScreen" class="legal-modal">
    <div class="legal-header">
        <h2>Privacy Policy</h2>
        <button onclick="hidePrivacy()" style="background:white; color:#667eea; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; float:right; margin-top:-5px;">Close</button>
    </div>
    <div class="legal-content">
        <p><strong>Last Updated:</strong> January 2026</p>
        
        <h2>Data Collection</h2>
        <p>This app stores all data locally on your device using browser local storage. We do not collect or transmit any personal data to external servers.</p>
        
        <h2>Information Stored</h2>
        <p>The following information is stored locally on your device:</p>
        <p>‚Ä¢ Your name and email (as entered by you)<br>
        ‚Ä¢ Daily screen time logs<br>
        ‚Ä¢ Challenge completion status<br>
        ‚Ä¢ Points and statistics</p>
        
        <h2>Data Security</h2>
        <p>Your data remains on your device and is never transmitted to us or third parties. You have full control to delete all data at any time via the Settings menu.</p>
        
        <h2>Contact</h2>
        <p>For questions about this privacy policy, please contact us through the app.</p>
    </div>
</div>

<div id="termsScreen" class="legal-modal">
    <div class="legal-header">
        <h2>Terms of Service</h2>
        <button onclick="hideTerms()" style="background:white; color:#667eea; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; float:right; margin-top:-5px;">Close</button>
    </div>
    <div class="legal-content">
        <p><strong>Last Updated:</strong> January 2026</p>
        
        <h2>Acceptance of Terms</h2>
        <p>By using Digital Detox Champion, you agree to these terms of service.</p>
        
        <h2>Use of Service</h2>
        <p>This app is provided as-is for personal use to help manage screen time. We make no guarantees about the effectiveness of the app for reducing screen time.</p>
        
        <h2>User Responsibilities</h2>
        <p>You are responsible for:</p>
        <p>‚Ä¢ Providing accurate information<br>
        ‚Ä¢ Backing up your data if desired<br>
        ‚Ä¢ Using the app responsibly</p>
        
        <h2>Disclaimer</h2>
        <p>This app is not a substitute for professional medical or mental health advice. If you have concerns about technology addiction, please consult a healthcare professional.</p>
        
        <h2>Changes to Terms</h2>
        <p>We reserve the right to modify these terms at any time. Continued use of the app constitutes acceptance of updated terms.</p>
    </div>
</div>

<div id="overlay" class="overlay" onclick="closePopup()"></div>
<div id="popup" class="popup">
    <div class="popup-icon" id="popupIcon">üéâ</div>
    <h2 id="popupTitle">Great!</h2>
    <p id="popupMessage" style="color:#6b7280; margin:20px 0;"></p>
    <button class="btn" onclick="closePopup()">Got it!</button>
</div>

<div class="footer">
    <p>¬© 2026 Digital Detox Champion | Ages 13+ | <a href="#" onclick="showPrivacy(); return false;">Privacy</a> | <a href="#" onclick="showTerms(); return false;">Terms</a></p>
</div>

<script>
var userData = {
    name: '',
    email: '',
    goal: 4,
    points: 0,
    streak: 0,
    rank: 999,
    challenges: 0,
    days: {}
};

var challengesData = [
    {id:1, title:'2-Hour Phone-Free Focus', desc:'No phone for 2 hours', points:130},
    {id:2, title:'Phone-Free Dinner', desc:'Enjoy meals without phone', points:50},
    {id:3, title:'Bedtime Digital Detox', desc:'1 hour before sleep', points:75},
    {id:4, title:'Morning Without Phone', desc:'Start day phone-free', points:60}
];

function saveData(key, val) {
    try {
        localStorage.setItem(key, JSON.stringify(val));
    } catch(e) {}
}

function loadData(key) {
    try {
        var item = localStorage.getItem(key);
        return item ? JSON.parse(item) : null;
    } catch(e) {
        return null;
    }
}

function removeData(key) {
    try {
        localStorage.removeItem(key);
    } catch(e) {}
}

function getToday() {
    var d = new Date();
    return d.getFullYear() + '-' + (d.getMonth()+1) + '-' + d.getDate();
}

function cleanOldDays() {
    var cutoff = Date.now() - (7 * 24 * 60 * 60 * 1000);
    var newDays = {};
    for (var k in userData.days) {
        var parts = k.split('-');
        var d = new Date(parseInt(parts[0]), parseInt(parts[1])-1, parseInt(parts[2]));
        if (d.getTime() >= cutoff) {
            newDays[k] = userData.days[k];
        }
    }
    userData.days = newDays;
}

function updateUI() {
    document.getElementById('userName2').textContent = userData.name;
    document.getElementById('points').textContent = userData.points;
    document.getElementById('dayStreak').textContent = userData.streak;
    document.getElementById('personalScore').textContent = '#' + userData.rank;
    document.getElementById('challenges').textContent = userData.challenges;
    
    document.getElementById('currentGoal').textContent = userData.goal;
    document.getElementById('totalPoints').textContent = userData.points;
    document.getElementById('currentRank').textContent = userData.rank;
    document.getElementById('totalChallenges').textContent = userData.challenges;
    document.getElementById('currentStreak').textContent = userData.streak;
    
    var today = getToday();
    var t = (userData.days[today] && userData.days[today].total) || 0;
    var h = Math.floor(t / 60);
    var m = t % 60;
    document.getElementById('todayTotal').textContent = h + 'h ' + m + 'm';
}

function renderChallenges() {
    var html = '';
    for (var i = 0; i < challengesData.length; i++) {
        var c = challengesData[i];
        html += '<div class="challenge-item" id="ch' + c.id + '">';
        html += '<div class="challenge-header">';
        html += '<div class="challenge-title">' + c.title + '</div>';
        html += '<div class="challenge-points">+' + c.points + ' pts</div>';
        html += '</div>';
        html += '<div class="challenge-desc">' + c.desc + '</div>';
        html += '<div class="challenge-actions">';
        html += '<button class="btn-small btn-complete" onclick="completeChallenge(' + c.id + ',' + c.points + ')">‚úì Completed</button>';
        html += '<button class="btn-small btn-fail" onclick="failChallenge(' + c.id + ')">‚úó Failed</button>';
        html += '</div></div>';
    }
    document.getElementById('challengesList').innerHTML = html;
}

function renderHistory() {
    var html = '';
    var keys = Object.keys(userData.days).sort().reverse();
    
    if (keys.length === 0) {
        html = '<p style="color:#6b7280; text-align:center; padding:20px;">No history yet. Start logging your screen time!</p>';
    } else {
        var apps = ['youtube','facebook','instagram','whatsapp','games','other'];
        var icons = ['üì∫','üë•','üì∏','üí¨','üéÆ','üì±'];
        var names = ['YouTube','Facebook','Instagram','WhatsApp','Games','Other'];
        
        for (var i = 0; i < keys.length; i++) {
            var k = keys[i];
            var data = userData.days[k];
            var parts = k.split('-');
            var d = new Date(parseInt(parts[0]), parseInt(parts[1])-1, parseInt(parts[2]));
            var dateStr = d.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});
            
            html += '<div class="day-entry">';
            html += '<div class="day-header">';
            html += '<div class="day-date">' + dateStr + '</div>';
            html += '<div class="day-total">' + (data.total / 60).toFixed(1) + 'h</div>';
            html += '</div>';
            html += '<div class="day-apps">';
            
            for (var j = 0; j < apps.length; j++) {
                if (data[apps[j]] && data[apps[j]] > 0) {
                    html += '<div class="app-stat">' + icons[j] + ' ' + names[j] + 
                            ': <strong>' + (data[apps[j]] / 60).toFixed(1) + 'h</strong></div>';
                }
            }
            html += '</div></div>';
        }
    }
    document.getElementById('historyList').innerHTML = html;
}

function showPopup(msg, type) {
    var icons = {excellent:'üåü', success:'üéâ', warning:'‚ö†Ô∏è', bad:'üòî'};
    var titles = {excellent:'Excellent!', success:'Great!', warning:'Careful!', bad:'Too Much!'};
    
    document.getElementById('popupIcon').textContent = icons[type] || 'üéâ';
    document.getElementById('popupTitle').textContent = titles[type] || 'Great!';
    document.getElementById('popupMessage').textContent = msg;
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('popup').style.display = 'block';
}

function closePopup() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('popup').style.display = 'none';
}

function calcBreakdown() {
    var t = 0;
    var hs = document.querySelectorAll('.app-h');
    var ms = document.querySelectorAll('.app-m');
    for (var i = 0; i < hs.length; i++) {
        t += (parseInt(hs[i].value) || 0) * 60 + (parseInt(ms[i].value) || 0);
    }
    var th = Math.floor(t / 60);
    var tm = t % 60;
    if (th > 24) { th = 24; tm = 0; }
    document.getElementById('addHours').value = th;
    document.getElementById('addMins').value = tm;
}

function handleLogin() {
    var n = document.getElementById('userName').value.trim();
    var e = document.getElementById('userEmail').value.trim();
    var g = parseInt(document.getElementById('goalSlider').value);
    
    if (!n || !e) {
        alert('Please enter your name and email!');
        return;
    }
    if (e.indexOf('@') === -1) {
        alert('Please enter a valid email!');
        return;
    }
    
    userData.name = n;
    userData.email = e;
    userData.goal = g;
    
    saveData('detoxData', userData);
    
    document.getElementById('welcomeScreen').classList.remove('active');
    document.getElementById('mainApp').classList.add('active');
    updateUI();
    renderChallenges();
    showPopup('Welcome ' + n + '! Start tracking your screen time! üöÄ', 'success');
}

function handleSave() {
    var ah = parseInt(document.getElementById('addHours').value) || 0;
    var am = parseInt(document.getElementById('addMins').value) || 0;
    var at = ah * 60 + am;
    
    if (at === 0) {
        alert('Please enter some time!');
        return;
    }
    
    var today = getToday();
    if (!userData.days[today]) {
        userData.days[today] = {
            total: 0,
            youtube: 0,
            facebook: 0,
            instagram: 0,
            whatsapp: 0,
            games: 0,
            other: 0
        };
    }
    
    var nt = userData.days[today].total + at;
    if (nt > 1440) {
        alert('Cannot exceed 24 hours per day!');
        return;
    }
    
    userData.days[today].total = nt;
    
    var hs = document.querySelectorAll('.app-h');
    var ms = document.querySelectorAll('.app-m');
    var apps = ['youtube','facebook','instagram','whatsapp','games','other'];
    
    for (var i = 0; i < 6; i++) {
        userData.days[today][apps[i]] += (parseInt(hs[i].value) || 0) * 60 + (parseInt(ms[i].value) || 0);
    }
    
    userData.points += 10;
    userData.rank = Math.max(1, Math.min(999, 1000 - Math.floor(userData.points / 10)));
    
    cleanOldDays();
    saveData('detoxData', userData);
    
    updateUI();
    renderHistory();
    
    var hrs = userData.days[today].total / 60;
    if (hrs <= userData.goal * 0.7) {
        showPopup('Awesome! Only ' + hrs.toFixed(1) + 'h today! Keep it up! üåü', 'excellent');
    } else if (hrs <= userData.goal) {
        showPopup('Great! Within your goal! +10 points! üéâ', 'success');
    } else if (hrs <= userData.goal * 1.3) {
        showPopup('Warning! You are ' + (hrs - userData.goal).toFixed(1) + 'h over your goal! ‚ö†Ô∏è', 'warning');
    } else {
        showPopup('Too much screen time! ' + hrs.toFixed(1) + 'h today! üòî', 'bad');
    }
    
    document.getElementById('addHours').value = 0;
    document.getElementById('addMins').value = 0;
    var all = document.querySelectorAll('.app-h, .app-m');
    for (var i = 0; i < all.length; i++) { all[i].value = 0; }
}

function completeChallenge(id, pts) {
    userData.points += pts;
    userData.challenges++;
    userData.rank = Math.max(1, Math.min(999, 1000 - Math.floor(userData.points / 10)));
    
    saveData('detoxData', userData);
    updateUI();
    
    document.getElementById('ch' + id).querySelector('.challenge-actions').innerHTML = 
        '<div style="color:#10b981;font-weight:600;text-align:center;">‚úì Completed!</div>';
    showPopup('Challenge completed! +' + pts + ' points! üéâ', 'success');
}

function failChallenge(id) {
    document.getElementById('ch' + id).querySelector('.challenge-actions').innerHTML = 
        '<div style="color:#ef4444;font-weight:600;text-align:center;">Try again tomorrow!</div>';
}

function switchTab(tab) {
    var tabs = document.querySelectorAll('.tab-content');
    for (var i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
    }
    
    var navs = document.querySelectorAll('.nav-item');
    for (var i = 0; i < navs.length; i++) {
        navs[i].classList.remove('active');
    }
    
    document.getElementById(tab + 'Tab').classList.add('active');
    var navIndex = tab === 'home' ? 0 : tab === 'history' ? 1 : tab === 'stats' ? 2 : 3;
    navs[navIndex].classList.add('active');
    
    if (tab === 'history') {
        renderHistory();
    }
}

function showPrivacy() {
    document.getElementById('privacyScreen').classList.add('active');
}

function hidePrivacy() {
    document.getElementById('privacyScreen').classList.remove('active');
}

function showTerms() {
    document.getElementById('termsScreen').classList.add('active');
}

function hideTerms() {
    document.getElementById('termsScreen').classList.remove('active');
}

function clearAllData() {
    if (confirm('Are you sure? This will delete ALL your data permanently! This cannot be undone!')) {
        removeData('detoxData');
        userData = {name:'',email:'',goal:4,points:0,streak:0,rank:999,challenges:0,days:{}};
        document.getElementById('mainApp').classList.remove('active');
        document.getElementById('welcomeScreen').classList.add('active');
        alert('All data cleared successfully!');
    }
}

document.getElementById('goalSlider').addEventListener('input', function() {
    document.getElementById('goalValue').textContent = this.value;
});

window.onload = function() {
    var saved = loadData('detoxData');
    if (saved) {
        userData = saved;
        cleanOldDays();
        saveData('detoxData', userData);
        document.getElementById('welcomeScreen').classList.remove('active');
        document.getElementById('mainApp').classList.add('active');
        updateUI();
        renderChallenges();
    }
};
</script>

</body>
</html>
